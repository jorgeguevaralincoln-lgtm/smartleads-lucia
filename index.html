<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portal de Beneficios Familiares</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .chat-container { height: 65vh; }
        .bubble { max-width: 85%; padding: 12px; border-radius: 18px; margin-bottom: 12px; font-size: 16px; line-height: 1.4; }
        .lucia { background: #f0f9ff; color: #0369a1; align-self: flex-start; border-bottom-left-radius: 4px; border: 1px solid #bae6fd; }
        .user { background: #0369a1; color: white; align-self: flex-end; border-bottom-right-radius: 4px; }
    </style>
</head>
<body class="bg-slate-50 font-sans">
    <div class="max-w-md mx-auto bg-white shadow-2xl min-h-screen flex flex-col border-x">
        <div class="bg-blue-800 p-5 text-white shadow-lg">
            <h1 class="text-xl font-bold">Portal de Beneficios</h1>
            <div class="flex items-center gap-2 opacity-90">
                <span class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></span>
                <p class="text-xs font-medium">Asistencia Licenciada en Florida</p>
            </div>
        </div>

        <div id="chat-box" class="chat-container p-4 flex flex-col flex-grow overflow-y-auto bg-white">
            <div class="bubble lucia shadow-sm">
                ¡Hola! Qué gusto saludarle. Soy Lucía, asistente del Portal de Beneficios Familiares. Mi labor es orientarle con respeto sobre los programas disponibles para su tranquilidad. <br><br>¿Con quién tengo el gusto de hablar?
            </div>
        </div>

        <div id="loading" class="px-4 text-xs text-gray-400 hidden italic mb-4">Lucía está consultando los programas...</div>

        <div class="p-4 bg-slate-50 border-t flex items-center gap-2">
            <input id="user-input" type="text" placeholder="Escriba su mensaje aquí..." 
                class="flex-grow border border-slate-300 rounded-full px-5 py-3 outline-none focus:border-blue-500 shadow-sm">
            <button id="send-btn" class="bg-blue-700 hover:bg-blue-800 text-white p-3 rounded-full transition-all shadow-md">
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5" />
                </svg>
            </button>
        </div>
    </div>

    <script>
        const API_KEY = "AIzaSyATzJL2mo1bRmweUhK4RXh4BO3KLwBhw8g"; 
        const chatBox = document.getElementById('chat-box');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const loading = document.getElementById('loading');

        const SYSTEM_PROMPT = `Eres Lucía, asistente del Portal de Beneficios Familiares en Florida. 
        Tu objetivo es calificar prospectos para seguros de gastos finales con respeto y empatía.
        REGLAS DE ORO:
        1. No des precios fijos, da rangos diarios aproximados (ej: $0.75 a $1.50).
        2. Si tienen 2 años sin problemas graves de salud, calificarán para mejores precios.
        3. Siempre posiciona al "Especialista Licenciado por el Estado" como la autoridad para validar beneficios.
        4. No menciones marcas de seguros.
        5. Sé breve, profesional y deja que el usuario sienta que tiene el control.
        6. Al final, ofrece contacto por WhatsApp o llamada para hablar con el especialista.`;

        let history = [{ role: "user", parts: [{ text: SYSTEM_PROMPT }] }];

        function appendMessage(role, text) {
            const div = document.createElement('div');
            div.className = `bubble shadow-sm ${role}`;
            div.innerText = text;
            chatBox.appendChild(div);
            chatBox.scrollTop = chatBox.scrollHeight;
        }

        async function sendMessage() {
            const text = userInput.value.trim();
            if (!text) return;

            appendMessage('user', text);
            userInput.value = '';
            loading.classList.remove('hidden');

            history.push({ role: "user", parts: [{ text: text }] });

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ contents: history })
                });

                const data = await response.json();
                const aiText = data.candidates[0].content.parts[0].text;
                
                loading.classList.add('hidden');
                appendMessage('lucia', aiText);
                history.push({ role: "model", parts: [{ text: aiText }] });

            } catch (error) {
                loading.classList.add('hidden');
                appendMessage('lucia', "Lo siento, tuve un pequeño problema de conexión. ¿Podría repetir eso?");
                console.error(error);
            }
        }

        sendBtn.addEventListener('click', sendMessage);
        userInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') sendMessage(); });
    </script>
</body>
</html>
